!function(r){r.extend(r.fn.datagrid.defaults,{onBeforeDrag:function(r){},onStartDrag:function(r){},onStopDrag:function(r){},onDragEnter:function(r,t){},onDragOver:function(r,t){},onDragLeave:function(r,t){},onBeforeDrop:function(r,t,e){},onDrop:function(r,t,e){}}),r.extend(r.fn.datagrid.methods,{enableDnd:function(t,e){return t.each(function(){function t(t,e){r(t).draggable("proxy").find("span.tree-dnd-icon").removeClass("tree-dnd-yes tree-dnd-no").addClass(e?"tree-dnd-yes":"tree-dnd-no")}function d(t){return i.finder.getRow(a,r(t))}var a=this,n=r.data(this,"datagrid");n.disabledRows=[];var o=r(this),i=n.options;if(void 0!=e)var s=i.finder.getTr(this,e);else var s=i.finder.getTr(this,0,"allbody");s.draggable({disabled:!1,revert:!0,cursor:"pointer",proxy:function(t){var e=r(t).attr("datagrid-row-index"),d=i.finder.getTr(a,e,"body",1),n=i.finder.getTr(a,e,"body",2),o=r('<div style="z-index:9999999999999"></div>').appendTo("body");return n.clone().removeAttr("id").removeClass("droppable").appendTo(o),d.clone().removeAttr("id").removeClass("droppable").find("td").insertBefore(o.find("td:first")),r('<td><span class="tree-dnd-icon tree-dnd-no" style="position:static">&nbsp;</span></td>').insertBefore(o.find("td:first")),o.find("td").css("vertical-align","middle"),o.hide(),o},deltaX:15,deltaY:15,onBeforeDrag:function(t){return 0!=i.onBeforeDrag.call(a,d(this))&&(!r(t.target).parent().hasClass("datagrid-cell-check")&&(1==t.which&&void i.finder.getTr(a,r(this).attr("datagrid-row-index")).droppable({accept:"no-accept"})))},onStartDrag:function(){r(this).draggable("proxy").css({left:-1e4,top:-1e4});var t=d(this);i.onStartDrag.call(a,t),n.draggingRow=t},onDrag:function(t){var e=t.pageX,d=t.pageY,n=t.data.startX,o=t.data.startY;if(Math.sqrt((e-n)*(e-n)+(d-o)*(d-o))>3){r(this).draggable("proxy").show();var s=i.finder.getTr(a,parseInt(r(this).attr("datagrid-row-index")),"body");r.extend(t.data,{startX:s.offset().left,startY:s.offset().top,offsetWidth:0,offsetHeight:0})}this.pageY=t.pageY},onStopDrag:function(){for(var r=0;r<n.disabledRows.length;r++){var t=o.datagrid("getRowIndex",n.disabledRows[r]);t>=0&&i.finder.getTr(a,t).droppable("enable")}n.disabledRows=[];var t=o.datagrid("getRowIndex",n.draggingRow);o.datagrid("enableDnd",t),i.onStopDrag.call(a,n.draggingRow)}}).droppable({accept:"tr.datagrid-row",onDragEnter:function(e,o){if(0==i.onDragEnter.call(a,d(this),d(o))){t(o,!1);var s=i.finder.getTr(a,r(this).attr("datagrid-row-index"));s.find("td").css("border",""),s.droppable("disable"),n.disabledRows.push(d(this))}},onDragOver:function(e,o){var s=d(this);if(!(r.inArray(s,n.disabledRows)>=0)){var g=o.pageY,l=r(this).offset().top,f=l+r(this).outerHeight();t(o,!0);var c=i.finder.getTr(a,r(this).attr("datagrid-row-index"));c.children("td").css("border",""),g>l+(f-l)/2?c.children("td").css("border-bottom","1px solid red"):c.children("td").css("border-top","1px solid red"),0==i.onDragOver.call(a,s,d(o))&&(t(o,!1),c.find("td").css("border",""),c.droppable("disable"),n.disabledRows.push(s))}},onDragLeave:function(e,n){t(n,!1),i.finder.getTr(a,r(this).attr("datagrid-row-index")).children("td").css("border",""),i.onDragLeave.call(a,d(this),d(n))},onDrop:function(t,e){var d=parseInt(r(e).attr("datagrid-row-index")),n=parseInt(r(this).attr("datagrid-row-index")),s=i.finder.getTr(a,r(this).attr("datagrid-row-index")),g=s.children("td"),l=parseInt(g.css("border-top-width"))?"top":"bottom";g.css("border","");var f=o.datagrid("getRows"),c=f[n],p=f[d];0!=i.onBeforeDrop.call(a,c,p,l)&&(!function(){var t=r(a).datagrid("getRows")[d],e=0;e="top"==l?n:n+1,e<d?(o.datagrid("deleteRow",d).datagrid("insertRow",{index:e,row:t}),o.datagrid("enableDnd",e)):(o.datagrid("insertRow",{index:e,row:t}).datagrid("deleteRow",d),o.datagrid("enableDnd",e-1))}(),i.onDrop.call(a,c,p,l))}})})}})}(jQuery);
//# sourceMappingURL=datagrid-dnd.js.map