/**
 * jQuery EasyUI 1.4.1
 * 
 * Copyright (c) 2009-2014 www.jeasyui.com. All rights reserved.
 *
 * Licensed under the GPL license: http://www.gnu.org/licenses/gpl.txt
 * To use it on other terms please contact us at info@jeasyui.com
 *
 */


!function(t){function e(e){function i(i,o){a.remainText=!1,n(),r.multiple||t(e).combo("hidePanel"),r.onClickRow.call(this,i,o)}function n(){for(var i=l.datagrid("getSelections"),o=[],n=[],d=0;d<i.length;d++)o.push(i[d][r.idField]),n.push(i[d][r.textField]);r.multiple?t(e).combo("setValues",o):t(e).combo("setValues",o.length?o:[""]),a.remainText||t(e).combo("setText",n.join(r.separator))}var a=t.data(e,"combogrid"),r=a.options,l=a.grid;t(e).addClass("combogrid-f").combo(t.extend({},r,{onShowPanel:function(){var e=t(this).combogrid("panel"),i=e.outerHeight()-e.height(),o=e._size("minHeight"),n=e._size("maxHeight");t(this).combogrid("grid").datagrid("resize",{width:"100%",height:isNaN(parseInt(r.panelHeight))?"auto":"100%",minHeight:o?o-i:"",maxHeight:n?n-i:""}),r.onShowPanel.call(this)}}));var d=t(e).combo("panel");l||(l=t("<table></table>").appendTo(d),a.grid=l),l.datagrid(t.extend({},r,{border:!1,singleSelect:!r.multiple,onLoadSuccess:function(i){var n=t(e).combo("getValues"),l=r.onSelect;r.onSelect=function(){},o(e,n,a.remainText),r.onSelect=l,r.onLoadSuccess.apply(e,arguments)},onClickRow:i,onSelect:function(t,e){n(),r.onSelect.call(this,t,e)},onUnselect:function(t,e){n(),r.onUnselect.call(this,t,e)},onSelectAll:function(t){n(),r.onSelectAll.call(this,t)},onUnselectAll:function(t){r.multiple&&n(),r.onUnselectAll.call(this,t)}}))}function i(e,i){var o=t.data(e,"combogrid"),n=o.options,a=o.grid,r=a.datagrid("getRows").length;if(r){var l=n.finder.getTr(a[0],null,"highlight");l.length||(l=n.finder.getTr(a[0],null,"selected"));var d;if(l.length){var d=parseInt(l.attr("datagrid-row-index"));d+="next"==i?1:-1,d<0&&(d=r-1),d>=r&&(d=0)}else d="next"==i?0:r-1;a.datagrid("highlightRow",d),n.selectOnNavigation&&(o.remainText=!1,a.datagrid("selectRow",d))}}function o(e,i,o){var n=t.data(e,"combogrid"),a=n.options,r=n.grid,l=r.datagrid("getRows"),d=[],s=t(e).combo("getValues"),c=t(e).combo("options"),g=c.onChange;c.onChange=function(){},r.datagrid("clearSelections"),t.isArray(i)||(i=i.split(a.separator));for(var u=0;u<i.length;u++){var h=r.datagrid("getRowIndex",i[u]);h>=0?(r.datagrid("selectRow",h),d.push(l[h][a.textField])):d.push(i[u])}if(t(e).combo("setValues",s),c.onChange=g,t(e).combo("setValues",i),!o){var f=d.join(a.separator);t(e).combo("getText")!=f&&t(e).combo("setText",f)}}function n(e,i){var n=t.data(e,"combogrid"),a=n.options,r=n.grid;if(n.remainText=!0,a.multiple&&!i?o(e,[],!0):o(e,[i],!0),"remote"==a.mode)r.datagrid("clearSelections"),r.datagrid("load",t.extend({},a.queryParams,{q:i}));else{if(!i)return;r.datagrid("clearSelections").datagrid("highlightRow",-1);var l=r.datagrid("getRows"),d=a.multiple?i.split(a.separator):[i];t.map(d,function(i){(i=t.trim(i))&&t.map(l,function(t,o){i==t[a.textField]?r.datagrid("selectRow",o):a.filter.call(e,i,t)&&r.datagrid("highlightRow",o)})})}}function a(e){var i=t.data(e,"combogrid"),o=i.options,n=i.grid,a=o.finder.getTr(n[0],null,"highlight");if(i.remainText=!1,a.length){var r=parseInt(a.attr("datagrid-row-index"));o.multiple&&a.hasClass("datagrid-row-selected")?n.datagrid("unselectRow",r):n.datagrid("selectRow",r)}var l=[];t.map(n.datagrid("getSelections"),function(t){l.push(t[o.idField])}),t(e).combogrid("setValues",l),o.multiple||t(e).combogrid("hidePanel")}t.fn.combogrid=function(i,o){if("string"==typeof i){var n=t.fn.combogrid.methods[i];return n?n(this,o):this.combo(i,o)}return i=i||{},this.each(function(){var o=t.data(this,"combogrid");o?t.extend(o.options,i):o=t.data(this,"combogrid",{options:t.extend({},t.fn.combogrid.defaults,t.fn.combogrid.parseOptions(this),i)}),e(this)})},t.fn.combogrid.methods={options:function(e){var i=e.combo("options");return t.extend(t.data(e[0],"combogrid").options,{width:i.width,height:i.height,originalValue:i.originalValue,disabled:i.disabled,readonly:i.readonly})},grid:function(e){return t.data(e[0],"combogrid").grid},setValues:function(t,e){return t.each(function(){o(this,e)})},setValue:function(t,e){return t.each(function(){o(this,[e])})},clear:function(e){return e.each(function(){t(this).combogrid("grid").datagrid("clearSelections"),t(this).combo("clear")})},reset:function(e){return e.each(function(){var e=t(this).combogrid("options");e.multiple?t(this).combogrid("setValues",e.originalValue):t(this).combogrid("setValue",e.originalValue)})}},t.fn.combogrid.parseOptions=function(e){t(e);return t.extend({},t.fn.combo.parseOptions(e),t.fn.datagrid.parseOptions(e),t.parser.parseOptions(e,["idField","textField","mode"]))},t.fn.combogrid.defaults=t.extend({},t.fn.combo.defaults,t.fn.datagrid.defaults,{height:22,loadMsg:null,idField:null,textField:null,mode:"local",keyHandler:{up:function(t){i(this,"prev"),t.preventDefault()},down:function(t){i(this,"next"),t.preventDefault()},left:function(t){},right:function(t){},enter:function(t){a(this)},query:function(t,e){n(this,t)}},filter:function(e,i){return 0==i[t(this).combogrid("options").textField].toLowerCase().indexOf(e.toLowerCase())}})}(jQuery);
//# sourceMappingURL=jquery.combogrid.js.map