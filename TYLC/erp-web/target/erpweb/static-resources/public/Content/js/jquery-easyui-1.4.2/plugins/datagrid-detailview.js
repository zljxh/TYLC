$.extend($.fn.datagrid.defaults,{autoUpdateDetail:!0});var detailview=$.extend({},$.fn.datagrid.defaults.view,{render:function(t,a,d){var e=$.data(t,"datagrid"),i=e.options;if(!d||i.rownumbers||i.frozenColumns&&i.frozenColumns.length){var r=e.data.rows,n=$(t).datagrid("getColumnFields",d),o=[];o.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var s=0;s<r.length;s++){var l=i.rowStyler?i.rowStyler.call(t,s,r[s]):"",g="",c="";"string"==typeof l?c=l:l&&(g=l.class||"",c=l.style||"");var h='class="datagrid-row '+(s%2&&i.striped?"datagrid-row-alt ":" ")+g+'"',u=c?'style="'+c+'"':"",p=e.rowIdPrefix+"-"+(d?1:2)+"-"+s;o.push('<tr id="'+p+'" datagrid-row-index="'+s+'" '+h+" "+u+">"),o.push(this.renderRow.call(this,t,n,d,s,r[s])),o.push("</tr>"),o.push('<tr style="display:none;">'),d?o.push("<td colspan="+(n.length+(i.rownumbers?1:0))+' style="border-right:0">'):o.push("<td colspan="+n.length+">"),o.push('<div class="datagrid-row-detail">'),d?o.push("&nbsp;"):o.push(i.detailFormatter.call(t,s,r[s])),o.push("</div>"),o.push("</td>"),o.push("</tr>")}o.push("</tbody></table>"),$(a).html(o.join(""))}},renderRow:function(t,a,d,e,i){var r=$.data(t,"datagrid").options,n=[];if(d&&r.rownumbers){var o=e+1;r.pagination&&(o+=(r.pageNumber-1)*r.pageSize),n.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+o+"</div></td>")}for(var s=0;s<a.length;s++){var l=a[s],g=$(t).datagrid("getColumnOption",l);if(g){var c=i[l],h=g.styler?g.styler(c,i,e)||"":"",u="",p="";"string"==typeof h?p=h:n&&(u=h.class||"",p=h.style||"");var f=u?'class="'+u+'"':"",v=g.hidden?'style="display:none;'+p+'"':p?'style="'+p+'"':"";n.push('<td field="'+l+'" '+f+" "+v+">"),g.checkbox?v="":g.expander?v="text-align:center;height:16px;":(v=p,g.align&&(v+=";text-align:"+g.align+";"),r.nowrap?r.autoRowHeight&&(v+=";height:auto;"):v+=";white-space:normal;height:auto;"),n.push('<div style="'+v+'" '),g.checkbox?n.push('class="datagrid-cell-check '):n.push('class="datagrid-cell '+g.cellClass),n.push('">'),g.checkbox?n.push('<input type="checkbox" name="'+l+'" value="'+(void 0!=c?c:"")+'">'):g.expander?n.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;" />'):g.formatter?n.push(g.formatter(c,i,e)):n.push(c),n.push("</div>"),n.push("</td>")}}return n.join("")},insertRow:function(t,a,d){function e(e){var r=i.finder.getTr(t,a,"body",e?1:2);if(n){var o=r.next(),s=r.next().clone();r.insertAfter(o)}else var s=r.next().next().clone();s.insertAfter(r),s.hide(),e||s.find("div.datagrid-row-detail").html(i.detailFormatter.call(t,a,d))}var i=$.data(t,"datagrid").options,r=$.data(t,"datagrid").dc,n=($(t).datagrid("getPanel"),r.view1,r.view2,!1),o=$(t).datagrid("getRows").length;if(0==o)return void $(t).datagrid("loadData",{total:1,rows:[d]});(void 0==a||null==a||a>=o)&&(a=o,n=!0,this.canUpdateDetail=!1),$.fn.datagrid.defaults.view.insertRow.call(this,t,a,d),e(!0),e(!1),this.canUpdateDetail=!0},deleteRow:function(t,a){var d=$.data(t,"datagrid").options,e=$.data(t,"datagrid").dc;d.finder.getTr(t,a).next().remove(),$.fn.datagrid.defaults.view.deleteRow.call(this,t,a),e.body2.triggerHandler("scroll")},updateRow:function(t,a,d){var e=($.data(t,"datagrid").dc,$.data(t,"datagrid").options),i=$(t).datagrid("getExpander",a).attr("class");if($.fn.datagrid.defaults.view.updateRow.call(this,t,a,d),$(t).datagrid("getExpander",a).attr("class",i),e.autoUpdateDetail&&this.canUpdateDetail){var d=$(t).datagrid("getRows")[a];$(t).datagrid("getRowDetail",a).html(e.detailFormatter.call(t,a,d))}},bindEvents:function(t){var a=$.data(t,"datagrid");if(!a.ss.bindDetailEvents){a.ss.bindDetailEvents=!0;var d=a.dc,e=(a.options,d.body1.add(d.body2)),i=($.data(e[0],"events")||$._data(e[0],"events")).click[0].handler;e.unbind("click").bind("click",function(a){var d=$(a.target),e=d.closest("tr.datagrid-row");if(e.length){if(d.hasClass("datagrid-row-expander")){var r=parseInt(e.attr("datagrid-row-index"));d.hasClass("datagrid-row-expand")?$(t).datagrid("expandRow",r):$(t).datagrid("collapseRow",r),$(t).datagrid("fixRowHeight")}else i(a);a.stopPropagation()}})}},onBeforeRender:function(t){for(var a=$.data(t,"datagrid"),d=a.options,e=a.dc,i=$(t),r=!1,n=i.datagrid("getColumnFields",!0).concat(i.datagrid("getColumnFields")),o=0;o<n.length;o++){if(i.datagrid("getColumnOption",n[o]).expander){r=!0;break}}if(!r){d.frozenColumns&&d.frozenColumns.length?d.frozenColumns[0].splice(0,0,{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}):d.frozenColumns=[[{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}]];var i=e.view1.children("div.datagrid-header").find("table"),s=$('<td rowspan="'+d.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:24px;"></div></td>');0==$("tr",i).length?s.wrap("<tr></tr>").parent().appendTo($("tbody",i)):d.rownumbers?s.insertAfter(i.find("td:has(div.datagrid-header-rownumber)")):s.prependTo(i.find("tr:first"))}},onAfterRender:function(t){function a(){var t=e.body2.find(">table.datagrid-btable>tbody>tr>td>div.datagrid-row-detail:visible");if(t.length){var a=0;e.header2.find(".datagrid-header-check:visible,.datagrid-cell:visible").each(function(){a+=$(this).outerWidth(!0)+1}),a!=t.outerWidth(!0)&&(t._outerWidth(a),t.find(".easyui-fluid").trigger("_resize"))}}var d=$.data(t,"datagrid"),e=d.dc,i=d.options,r=$(t).datagrid("getPanel");$.fn.datagrid.defaults.view.onAfterRender.call(this,t),d.onResizeColumn||(d.onResizeColumn=i.onResizeColumn,i.onResizeColumn=function(e,r){i.fitColumns||a();for(var n=$(t).datagrid("getRows").length,o=0;o<n;o++)$(t).datagrid("fixDetailRowHeight",o);d.onResizeColumn.call(t,e,r)}),d.onResize||(d.onResize=i.onResize,i.onResize=function(t,e){i.fitColumns&&a(),d.onResize.call(r,t,e)}),this.canUpdateDetail=!0,e.footer1.add(e.footer2).find("span.datagrid-row-expander").css("visibility","hidden"),$(t).datagrid("resize"),this.bindEvents(t),e.body1.add(e.body2).find("div.datagrid-row-detail").unbind().bind("mouseover mouseout click dblclick contextmenu scroll",function(t){t.stopPropagation()})}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(t,a){return t.each(function(){var t=$.data(this,"datagrid").options;if(t.rownumbers||t.frozenColumns&&t.frozenColumns.length){var d=$.data(this,"datagrid").dc,e=t.finder.getTr(this,a,"body",1).next(),i=t.finder.getTr(this,a,"body",2).next();if(i.is(":visible")){e.css("height",""),i.css("height","");var r=Math.max(e.height(),i.height());e.css("height",r),i.css("height",r)}d.body2.triggerHandler("scroll")}})},getExpander:function(t,a){return $.data(t[0],"datagrid").options.finder.getTr(t[0],a).find("span.datagrid-row-expander")},getRowDetail:function(t,a){return $.data(t[0],"datagrid").options.finder.getTr(t[0],a,"body",2).next().find(">td>div.datagrid-row-detail")},expandRow:function(t,a){return t.each(function(){var t=$(this).datagrid("options"),d=($.data(this,"datagrid").dc,$(this).datagrid("getExpander",a));if(d.hasClass("datagrid-row-expand")){d.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var e=t.finder.getTr(this,a,"body",1).next(),i=t.finder.getTr(this,a,"body",2).next();if(e.show(),i.show(),$(this).datagrid("fixDetailRowHeight",a),t.onExpandRow){var r=$(this).datagrid("getRows")[a];t.onExpandRow.call(this,a,r)}}})},collapseRow:function(t,a){return t.each(function(){var t=$(this).datagrid("options"),d=$.data(this,"datagrid").dc,e=$(this).datagrid("getExpander",a);if(e.hasClass("datagrid-row-collapse")){e.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var i=t.finder.getTr(this,a,"body",1).next(),r=t.finder.getTr(this,a,"body",2).next();if(i.hide(),r.hide(),d.body2.triggerHandler("scroll"),t.onCollapseRow){var n=$(this).datagrid("getRows")[a];t.onCollapseRow.call(this,a,n)}}})}}),$.extend($.fn.datagrid.methods,{subgrid:function(t,a){return t.each(function(){function t(a,r,n){var o=$.extend({},r.options.queryParams||{});if(n){var s=r.options.foreignField;$.isFunction(s)?$.extend(o,s.call(r,n)):o[s]=n[s]}var l=r.options.edatagrid?"edatagrid":"datagrid";$(a)[l]($.extend({},r.options,{subgrid:r.subgrid,view:r.subgrid?detailview:void 0,queryParams:o,detailFormatter:function(t,a){return'<div><table class="datagrid-subgrid"></table></div>'},onExpandRow:function(a,e){var n=$(this).datagrid("options"),o=$(this).datagrid("getRowDetail",a),s=d(o);s.data("datagrid")||t(s[0],n.subgrid,e),o.find(".easyui-fluid").trigger("_resize"),i(this,a),r.options.onExpandRow&&r.options.onExpandRow.call(this,a,e)},onCollapseRow:function(t,a){i(this,t),r.options.onCollapseRow&&r.options.onCollapseRow.call(this,t,a)},onResize:function(){$(this).children("div.datagrid-view").children("table");e(this)},onResizeColumn:function(t,a){e(this),r.options.onResizeColumn&&r.options.onResizeColumn.call(this,t,a)},onLoadSuccess:function(t){e(this),r.options.onLoadSuccess&&r.options.onLoadSuccess.call(this,t)}}))}function d(t){var a=$(t).children("div");return a.children("div.datagrid").length?a.find(">div.datagrid>div.panel-body>div.datagrid-view>table.datagrid-subgrid"):a.find(">table.datagrid-subgrid")}function e(t){var a=$(t).closest("div.datagrid-row-detail").closest("tr").prev();if(a.length){var d=parseInt(a.attr("datagrid-row-index"));i(a.closest("div.datagrid-view").children("table")[0],d)}}function i(t,a){$(t).datagrid("fixDetailRowHeight",a),$(t).datagrid("fixRowHeight",a);var d=$(t).closest("div.datagrid-row-detail").closest("tr").prev();if(d.length){var a=parseInt(d.attr("datagrid-row-index"));i(d.closest("div.datagrid-view").children("table")[0],a)}}t(this,a)})},getSelfGrid:function(t){var a=t.closest(".datagrid");return a.length?a.find(">.datagrid-wrap>.datagrid-view>.datagrid-f"):null},getParentGrid:function(t){var a=t.closest("div.datagrid-row-detail");return a.length?a.closest(".datagrid-view").children(".datagrid-f"):null},getParentRowIndex:function(t){var a=t.closest("div.datagrid-row-detail");if(a.length){var d=a.closest("tr").prev();return parseInt(d.attr("datagrid-row-index"))}return-1}});
//# sourceMappingURL=datagrid-detailview.js.map